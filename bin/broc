#!/usr/bin/env node

var program = require('commander')
var resolve = require('resolve')
var deploy  = require('../lib/tasks/deploy')

var broccoliPath = resolve.sync('broccoli', {
  basedir: process.cwd()
})
var broccoli = require(broccoliPath)

program
  .command('deploy <bucket>')
  .description('deploy assets to S3')
  .action(function(bucket) {
    var tree = broccoli.loadBrocfile()
    var builder = new broccoli.Builder(tree)
    builder
      .build()
      .then(function(hash) {
        deploy.run(hash.directory, bucket)
      })
  })

program.parse(process.argv)